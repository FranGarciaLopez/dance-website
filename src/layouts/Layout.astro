---
interface Props {
  title: string;
  description?: string;
  canonical?: string;
  keywords?: string;
  ogImage?: string;
  ogType?: string;
  author?: string;
  publishedTime?: string;
  modifiedTime?: string;
  noindex?: boolean;
}
const {
  title,
  description,
  canonical,
  keywords,
  ogImage,
  ogType = "website",
  author = "Juan Carlos y Luna - The Latin Action",
  publishedTime,
  modifiedTime,
  noindex = false,
} = Astro.props;

import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";

const defaultDescription =
  "ü•á Academia #1 de Salsa y Bachata en Elche ‚≠ê Clases para todos los niveles con Juan Carlos y Luna üìç Elche, Novelda, Elda üìû 645 08 91 22 ‚úÖ +20 a√±os de experiencia";
const defaultOgImage =
  "https://res.cloudinary.com/dgvvnopu7/image/upload/w_1200,h_630,c_fill,f_auto,q_auto/v1755352383/Foto_de_Juan_Carlos_y_Luna_The_Latin_Action_Salsa_y_Bachata_en_la_playa_absfwn.jpg";
const siteUrl = "https://thelatinaction.com";
const fullCanonicalUrl = canonical || `${siteUrl}${Astro.url.pathname}`;
---

<!doctype html>
<html lang="es" prefix="og: https://ogp.me/ns#">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description ?? defaultDescription} />
    {keywords && <meta name="keywords" content={keywords} />}
    <meta name="author" content={author} />
    {noindex && <meta name="robots" content="noindex, nofollow" />}
    {
      !noindex && (
        <meta
          name="robots"
          content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
        />
      )
    }
    <meta name="geo.region" content="ES-A" />
    <meta name="geo.placename" content="Elche" />
    <meta name="geo.position" content="38.2698339;-0.6986707" />

    <!-- Canonical URL -->
    <link rel="canonical" href={fullCanonicalUrl} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={fullCanonicalUrl} />
    <meta property="og:title" content={title} />
    <meta
      property="og:description"
      content={description ?? defaultDescription}
    />
    <meta property="og:image" content={ogImage ?? defaultOgImage} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={title} />
    <meta
      property="og:site_name"
      content="The Latin Action - Clases de Salsa y Bachata"
    />
    <meta property="og:locale" content="es_ES" />
    {
      publishedTime && (
        <meta property="article:published_time" content={publishedTime} />
      )
    }
    {
      modifiedTime && (
        <meta property="article:modified_time" content={modifiedTime} />
      )
    }

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={fullCanonicalUrl} />
    <meta name="twitter:title" content={title} />
    <meta
      name="twitter:description"
      content={description ?? defaultDescription}
    />
    <meta name="twitter:image" content={ogImage ?? defaultOgImage} />

    <!-- Additional SEO -->
    <meta name="theme-color" content="#3a304d" />

    <!-- Favicon and Icons -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://res.cloudinary.com" />
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />

    <!-- Preload critical fonts for better LCP -->
    <style>
      /* Critical font subset - Roboto Regular for immediate render */
      @font-face {
        font-family: 'Roboto';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url(https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxK.woff2) format('woff2');
        unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
      }
    </style>
    <!-- Load full fonts asynchronously -->
    <link
      rel="preload"
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Roboto+Slab:wght@400;500;700&display=swap"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />
    <noscript>
      <link
        href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Roboto+Slab:wght@400;500;700&display=swap"
        rel="stylesheet"
      />
    </noscript>

    <!-- PhotoSwipe CSS - Only load on gallery pages -->
    {Astro.url.pathname.includes('/galeria') && (
      <link
        rel="preload"
        href="https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.min.css"
        as="style"
        onload="this.onload=null;this.rel='stylesheet'"
      />
    )}
    <noscript>
      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.min.css"
      />
    </noscript>

    <!-- Structured Data - Organization -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "DanceSchool",
        "@id": "https://thelatinaction.com/#organization",
        "name": "The Latin Action",
        "alternateName": "Academia de Salsa y Bachata The Latin Action",
        "url": "https://thelatinaction.com",
        "logo": "https://res.cloudinary.com/dgvvnopu7/image/upload/v1755352383/Foto_de_Juan_Carlos_y_Luna_The_Latin_Action_Salsa_y_Bachata_en_la_playa_absfwn.jpg",
        "description": "Academia l√≠der de salsa y bachata en Elche con m√°s de 20 a√±os de experiencia. Clases para todos los niveles con Juan Carlos y Luna.",
        "telephone": "+34645089122",
        "email": "info@thelatinaction.com",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "M√∫ltiples ubicaciones",
          "addressLocality": "Elche",
          "addressRegion": "Alicante",
          "postalCode": "03200",
          "addressCountry": "ES"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": "38.2698339",
          "longitude": "-0.6986707"
        },
        "areaServed": [
          {
            "@type": "City",
            "name": "Elche"
          },
          {
            "@type": "City",
            "name": "Novelda"
          },
          {
            "@type": "City",
            "name": "Elda"
          }
        ],
        "sameAs": [
          "https://www.instagram.com/thelatinaction/",
          "https://www.facebook.com/thelatinaction"
        ],
        "priceRange": "‚Ç¨‚Ç¨",
        "openingHoursSpecification": [
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": [
              "Monday",
              "Tuesday",
              "Wednesday",
              "Thursday",
              "Friday"
            ],
            "opens": "18:00",
            "closes": "23:00"
          }
        ],
        "hasOfferCatalog": {
          "@type": "OfferCatalog",
          "name": "Clases de Baile Latino",
          "itemListElement": [
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Clases de Bachata y Salsa en Pareja",
                "description": "Clases de bachata y salsa para parejas, todos los niveles"
              }
            },
            {
              "@type": "Offer",
              "itemOffered": {
                "@type": "Service",
                "name": "Bachata Lady Style",
                "description": "Clases de bachata lady style para mujeres"
              }
            }
          ]
        }
      }
    </script>

    <!-- LocalBusiness Schema para SEO Local -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "LocalBusiness",
        "name": "The Latin Action - Academia de Salsa y Bachata",
        "image": "https://res.cloudinary.com/dgvvnopu7/image/upload/v1755352383/Foto_de_Juan_Carlos_y_Luna_The_Latin_Action_Salsa_y_Bachata_en_la_playa_absfwn.jpg",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Elche",
          "addressRegion": "Alicante",
          "postalCode": "03200",
          "addressCountry": "ES"
        },
        "telephone": "+34645089122",
        "url": "https://thelatinaction.com",
        "priceRange": "‚Ç¨‚Ç¨",
        "openingHoursSpecification": [
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": ["Monday", "Wednesday", "Friday"],
            "opens": "19:00",
            "closes": "22:00"
          },
          {
            "@type": "OpeningHoursSpecification",
            "dayOfWeek": ["Tuesday", "Thursday"],
            "opens": "18:30",
            "closes": "21:30"
          }
        ],
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 38.2698339,
          "longitude": -0.6986707
        },
        "aggregateRating": {
          "@type": "AggregateRating",
          "ratingValue": "4.9",
          "reviewCount": "150"
        }
      }
    </script>

    <slot name="head" />
  </head>
  <body class="bg-gray-900 text-white">
    <Header />

    <main class="min-h-screen">
      <slot />
    </main>

    <Footer />

    <!-- PhotoSwipe template (global) -->
    <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
      <div class="pswp__bg"></div>
      <div class="pswp__scroll-wrap">
        <div class="pswp__container">
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
          <div class="pswp__item"></div>
        </div>
        <div class="pswp__ui pswp__ui--hidden">
          <div class="pswp__top-bar">
            <div class="pswp__counter"></div>
            <button
              class="pswp__button pswp__button--close"
              title="Cerrar (Esc)"></button>
            <button class="pswp__button pswp__button--zoom" title="Zoom in/out"
            ></button>
            <div class="pswp__preloader">
              <div class="pswp__preloader__icn">
                <div class="pswp__preloader__cut">
                  <div class="pswp__preloader__donut"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="pswp__caption">
            <div class="pswp__caption__center"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Global PhotoSwipe Initialization - Optimized with defer -->
    <script type="module" is:inline>
      // Defer PhotoSwipe initialization until after page load
      let lightboxInitialized = false;

      // Cache viewport check to avoid forced reflow
      const isMobile = window.matchMedia('(max-width: 767px)').matches;

      async function initPhotoSwipe() {
        if (lightboxInitialized) return;
        lightboxInitialized = true;

        // Dynamic import reduces initial bundle blocking
        const PhotoSwipeLightbox = (await import("https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js")).default;
        const galleryEls = document.querySelectorAll("[data-pswp-gallery]");

        galleryEls.forEach((galleryEl) => {
          const lightbox = new PhotoSwipeLightbox({
            gallery: galleryEl,
            children: "a",
            pswpModule: () =>
              import(
                "https://cdn.jsdelivr.net/npm/photoswipe@5.4.4/dist/photoswipe.esm.min.js"
              ),
            zoomAnimationDuration: 300,
            arrowKeys: true,
            clickToCloseNonZoomable: true,
            mainScroll: false,
            maxSpreadZoom: isMobile ? 4 : 3,
          });

          lightbox.on("gettingData", (e) => {
            if (!e.element || !e.data) return;
            e.data.width = parseInt(e.element.dataset.pswpWidth || "0");
            e.data.height = parseInt(e.element.dataset.pswpHeight || "0");
          });

          lightbox.init();
        });
      }

      // Only initialize after full page load (not blocking render)
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          const galleries = document.querySelectorAll("[data-pswp-gallery]");
          if (galleries.length > 0) {
            // Wait for idle time or max 3 seconds
            if ('requestIdleCallback' in window) {
              requestIdleCallback(() => initPhotoSwipe(), { timeout: 3000 });
            } else {
              setTimeout(initPhotoSwipe, 2000);
            }
            
            // Also init on first click
            galleries.forEach(g => {
              g.addEventListener('click', initPhotoSwipe, { once: true });
            });
          }
        });
      } else {
        const galleries = document.querySelectorAll("[data-pswp-gallery]");
        if (galleries.length > 0) {
          if ('requestIdleCallback' in window) {
            requestIdleCallback(() => initPhotoSwipe(), { timeout: 2000 });
          } else {
            setTimeout(initPhotoSwipe, 1000);
          }
          galleries.forEach(g => {
            g.addEventListener('click', initPhotoSwipe, { once: true });
          });
        }
      }
    </script>
  </body>
</html>

<style is:global>
  /* === Base HTML & Body Styles === */
  html,
  body {
    font-family: "Inter", sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    background: linear-gradient(to bottom, #3a304d, #281f38);
    color: white;
    max-width: 100vw;
    overflow-x: hidden;
    scroll-behavior: smooth;
  }

  /* === Headings === */
  h1,
  h2,
  h3 {
    font-weight: 500; /* medium weight for readability */
    line-height: 1.3;
    letter-spacing: 0.5px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1,
  h2 {
    font-family: "Roboto", sans-serif;
  }

  /* === Paragraphs / Text === */
  p,
  li,
  span {
    font-family: "Roboto Slab", serif;
    line-height: 1.6;
    letter-spacing: 0.3px;
  }

  /* === Global Animations === */
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeIn 1.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    animation-delay: var(--animation-delay, 0s);
    opacity: 0;
  }
</style>
