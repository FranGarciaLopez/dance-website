---
// ImageMasonry.astro
import "photoswipe/dist/photoswipe.css";

interface Props {
  images: string[];
}
const { images } = Astro.props;

// Normalize current path (remove trailing slash)
const currentPath = Astro.url.pathname.replace(/\/$/, "").toLowerCase();
const isGaleria = currentPath === "/galeria";

// Images to exclude from homepage
const excludeMain = ["aiinhoa", "cann"];

// Filter images depending on route
const filteredImages = isGaleria
  ? images // show all on /galeria
  : images.filter(
      (img) => !excludeMain.some((word) => img.toLowerCase().includes(word))
    );

// Limit homepage images
const numImages = isGaleria ? images.length : 7;
const displayedImages = filteredImages.slice(0, numImages);

const CLOUD_NAME = "dgvvnopu7";
function cldUrl(publicId: string, width?: number, height?: number) {
  const w = width ? `w_${width},` : "";
  const h = height ? `h_${height},` : "";
  return `https://res.cloudinary.com/${CLOUD_NAME}/image/upload/${w}${h}c_limit,q_auto,f_auto,dpr_auto/${publicId}.webp`;
}
---

<section class="masonry-section px-6 py-12 max-w-5xl mx-auto" id="galeria">

  <div class="masonry-grid mx-auto" data-pswp-gallery>
    {displayedImages.map((publicId) => (
      <a
        href={cldUrl(publicId, 2000)}
        data-pswp-width="2000"
        data-pswp-height="1333"
        class="masonry-item block"
      >
        <div class="aspect-box">
          <img
            src={cldUrl(publicId, 600)}
            alt={publicId.replace(/[_-]/g, " ")}
            class="w-full h-full object-cover rounded-lg cursor-pointer hover:opacity-90 transition"
            loading="lazy"
          />
        </div>
      </a>
    ))}
  </div>

  {!isGaleria && (
    <div class="text-center mt-8">
      <a
        href="/galeria/"
        class="inline-block px-6 py-3 rounded-full bg-gradient-to-r from-pink-400 to-purple-600 text-white font-bebas text-xl hover:scale-105 transform transition duration-300 uppercase shadow-lg hover:shadow-xl"
      >
        Ver MÃ¡s Fotos
      </a>
    </div>
  )}
</section>

<style>
  .masonry-grid {
    column-count: 1;
    column-gap: 1rem;
  }
  @media (min-width: 768px) {
    .masonry-grid { column-count: 2; }
  }
  @media (min-width: 1024px) {
    .masonry-grid { column-count: 3; }
  }
  .masonry-item {
    margin-bottom: 1rem;
    break-inside: avoid;
    display: block;
  }

  /* PhotoSwipe image orientation */
  :global(.pswp__zoom-wrap) {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
  }
  :global(.pswp__img) {
    margin: 0 auto !important;
    top: 0 !important;
    left: 0 !important;
    object-fit: contain !important;
  }
  :global(.pswp-portrait) {
    max-height: 90vh !important;
    width: auto !important;
  }
  :global(.pswp-landscape) {
    max-width: 90vw !important;
    height: auto !important;
  }
</style>
