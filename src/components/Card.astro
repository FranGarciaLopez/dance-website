---
// Optimized Cloudinary utilities
const { title, image, shortDesc } = Astro.props;

function cloudinaryResize(url: string, width: number) {
  // Enforce 4:5 aspect ratio + smart crop + optimized format/quality
  return url.replace('/upload/', `/upload/w_${width},ar_4:5,c_fill,g_center,f_auto,q_auto,`);
}

function getBlurredPlaceholder(url: string, width: number) {
  // Match same 4:5 crop with blur effect for smooth transition
  return url.replace('/upload/', `/upload/w_${width},c_fill,g_auto,e_blur:2000,q_auto,f_auto/`);
}
---

<article
  class="relative group aspect-[4/5] w-full rounded-xl overflow-hidden shadow-lg transition-transform hover:scale-105 cursor-pointer"
>
  <!-- Optimized blurred placeholder with consistent crop -->
  <img
    src={getBlurredPlaceholder(image, 300)}
    data-src={cloudinaryResize(image, 600)}
    data-srcset={` 
      ${cloudinaryResize(image, 300)} 300w,
      ${cloudinaryResize(image, 600)} 600w,
      ${cloudinaryResize(image, 900)} 900w
    `}
    sizes="(max-width: 600px) 300px, (max-width: 900px) 600px, 900px"
    alt={title}
    class="w-full h-full object-cover lazyload"
    loading="lazy"
    decoding="async"
    draggable="false"
  />

  <!-- Soft full overlay for contrast -->
  <div class="absolute inset-0 bg-black/30 z-10"></div>

  <!-- Centered text block -->
  <div class="absolute inset-0 flex flex-col justify-center items-center text-center z-20 px-4">
    <h2 class="text-white text-3xl md:text-4xl font-extrabold drop-shadow-lg">
      {title}
    </h2>
    <p class="mt-2 text-white/90 text-lg md:text-xl max-w-xs drop-shadow">
      {shortDesc}
    </p>
  </div>
</article>

<!-- Lazysizes (only once per page/site) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js" async></script>
